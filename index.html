<!DOCTYPE html>
<html lang="en">
<head>
<title>Guild Wars 2 API Test</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"></meta>
<script type='text/javascript' src='js/jquery-1.9.1.min.js' ></script>
<meta name="viewport" content="width=320, initial-scale=1, maximum-scale=1">
<link href='css/bootstrap.min.css' rel='stylesheet' media='screen'></link>
<script type='text/javascript' src='js/bootstrap.min.js'></script>
<link href='css/wvwtimers-widget-style.css' rel='stylesheet' media='screen'></link>
</head>
<body>
    <div class="navbar">
    <div class="navbar-inner" style="padding-right:0;">
    <a class="brand" href="#">WvW Timers</a>
    <ul class="nav pull-right">
      <li class="divider-vertical" style="margin-right:3px;"></li>
      <li><a style="font-size:30px;" href="config.html" class="gear"></a></li>
    </ul>
    </div>
    </div>
<div class="WvWTimers-widget" mode="1" style="overflow: auto;margin:auto;"></div>
</div>
<script type="text/javascript">
$(document).ready(function(){
  localStorage.version = "1.0.4";
  if(typeof(Storage)!="undefined")
  {
    if(localStorage.server_id == undefined || localStorage.lang == undefined)
      window.location = "config.html";
    else
      $(".WvWTimers-widget").attr("server-id", localStorage.server_id);
  }
  else
  {
    alert("Sorry! No web storage support..");
  }

  $.getScript("js/wvwtimers-widget-mobile-"+localStorage.lang+".js");
  $.getScript("http://galbar.github.io/GW2-WvWTimers/js/remote_update.js");
});


function requestUpdate () {
/* Modal */
  $("body").append("<div id='updateAlert' class='modal hide fade' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true'>"+
    "<div class='modal-header'>"+
    "<button type='button' class='close' data-dismiss='modal' aria-hidden='true'>×</button>"+
    "<h3 id='myModalLabel'></h3>"+
    "</div>"+
    "<div class='modal-body'>"+
    "<p>One fine body…</p>"+
    "</div>"+
    "<div class='modal-footer'>"+
    "<button class='btn' id='updateAlertClose' data-dismiss='modal' aria-hidden='true'></button> "+
    "<a id='updateAlertAccept' class='btn btn-primary' href='#'></a>"+
    "</div>"+
    "</div>");

  if(localStorage.lang == "en")
  {
    $("#myModalLabel").html("New Version Available");
    $("#updateAlertClose").html("Close");
    $("#updateAlertAccept").html("Download");
    $(".modal-body").html("<strong>Version " + LatestVersion + ".<br>List of changes: </strong>" +
      "<ul>" +
      "<li> Added update alerts." +
      "</li>" +
      "<ul>");
  }
  else if (localStorage.lang == "fr")
  {
    $("#myModalLabel").html("Nouvelle Version Disponible");
    $("#updateAlertClose").html("Fermer");
    $("#updateAlertAccept").html("Télécharger");
    $(".modal-body").html("<strong>Version " + LatestVersion + ".<br>Liste des modifications: </strong>" +
      "<ul>" +
      "<li> Ajouté alertes de mise à jour." +
      "</li>" +
      "<ul>");
  }
  else if (localStorage.lang == "de")
  {
    $("#myModalLabel").html("Neue Version Verfügbar");
    $("#updateAlertClose").html("Schließen");
    $("#updateAlertAccept").html("Herunterladen");
    $(".modal-body").html("<strong>Version " + LatestVersion + ".<br>Liste der Änderungen: </strong>" +
      "<ul>" +
      "<li> Update Warnungen." +
      "</li>" +
      "<ul>");
  }
  else if (localStorage.lang == "es")
  {
    $("#myModalLabel").html("Nueva Versión Disponible");
    $("#updateAlertClose").html("Cerrar");
    $("#updateAlertAccept").html("Descargar");
    $(".modal-body").html("<strong>Versión " + LatestVersion + ".<br>Lista de cambios: </strong>" +
      "<ul>" +
      "<li> Añadido alertas de actualización." +
      "</li>" +
      "<ul>");
  }
    $('#updateAlert').modal('show');


    $("#updateAlertAccept").click(function(){

      // !! Assumes filePath is a valid path on the device

    var fileTransfer = new FileTransfer();
    var uri = encodeURI("http://build.phonegap.com/apps/440645/install/?qrkey=KisptxnCYUotJEmsyfPc");

    fileTransfer.download(
        uri,
        "/WvWTimers-Update.apk",
        function(entry) {
            console.log("download complete: " + entry.fullPath);
        },
        function(error) {
            console.log("download error source " + error.source);
            console.log("download error target " + error.target);
            console.log("upload error code" + error.code);
        },
        false,
        {
            headers: {
                "Authorization": "Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="
            }
        }
    );


      $('#updateAlert').modal('hide');

    })
}
</script>
</body>
</html>